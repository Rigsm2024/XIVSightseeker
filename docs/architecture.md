# アーキテクチャ

## バックエンド
- Next.jsのAPIを採用
- データはjsonファイルに格納し、起動時に読み込む
- モジュール
  - リポジトリ：jsonを読み、キャッシュを保持
  - 天気予報士：簡単な数値計算を行い、天気予報をする
  - 探検ガイド：天気予報を元にどの探検手帳項目がいつ達成可能になるかを計算する
- API
  - slogs: 探検手帳のstaticなデータのみを返却する (項目番号やエリア名、時間など)
  - guides: 天気予報士と探検ガイドが整えた探検手帳データを返却する

## フロントエンド
- Next.js + Tailwind
- 1ページのみのSPA
- 状態管理
  - 探検手帳データとフィルタを状態として保持
    - 探検手帳データ：天気予報に応じていつどの項目が可能かを格納したオブジェクト
    - フィルタ：ユーザの表示設定情報が格納されたオブジェクト (タブ番号や表示順など)
  - 更新されるとViewが再レンダリングされる仕組み
- 更新イベント
  - 探検手帳データ
    - いずれかの項目の残り時間が0になった (自動更新)
    - 長期間予報機能をONにした
  - フィルタ
    - タブを切り替えた
    - いずれかの項目を完了にした
    - 表示順を変更した
    - 完了項目の表示設定を切り替えた
- 起動時
  - 探検手帳データには予報に関係のないstaticなデータがあるため、それらはサーバサイドでレンダリングを済ませておく
  - 予報処理やフィルタの反映などはクライアントに処理が移行されてから後追いで行う (表示の高速化目的)
- ユーザ設定
  - フィルタオブジェクトをLocalStorageに保存
  - 項目の完了状態や表示順、完了の非表示などユーザの設定が保存されるようにしている

## インフラ
- プラットフォーム
  - Google Cloud Runにコンテナとしてデプロイ
  - GitHubへのプッシュをトリガに自動でクラウドビルドされるようになっている
  - ビルドはDockerfileでNext.jsのプロダクションビルドを行っている
- ドメイン
  - お名前.comでxivsightseeker.comのドメインを取得
  - Google Cloud Runでカスタムドメインを紐づけている
- クライアント
  - Chrome, Safari / Windows, Mac, iPhoneでの動作確認済み

